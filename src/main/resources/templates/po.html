<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
<title>Purchase Order</title>

<!-- Bootstrap -->
<link href="/Bootstrap/css/bootstrap.min.css" rel="stylesheet" />

<link href="/css/progress.css" rel="stylesheet" />

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
	<div class="masking">
		<h4 class="text-success text-center">处理中，请稍后...</h4>
		<div class="progress">
			<div class="progress-bar progress-bar-success" role="progressbar"
				aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"
				style="width: 0%">0% Complete</div>
		</div>
	</div>
	<nav th:include="nav::nav('po')" class="navbar navbar-inverse"></nav>
	<div class="container">
		<form class="form-inline" role="form" enctype="multipart/form-data"
			method="POST" action="/po/upload">
			<div class="form-group">
				<label for="poFile">File:</label> <input type="file"
					class="form-control" id="poFile" name="poFile" />
			</div>
			<button type="submit" class="btn btn-primary js-progress">
				<span class="glyphicon glyphicon-cloud-upload"></span> Upload
			</button>
			<a class="btn btn-success js-progress" href="/po/calculate"><span
				class="glyphicon glyphicon-pencil"></span> Calculate</a> <a
				class="btn btn-warning"
				href="https://msit.powerbi.com/groups/me/reports/f72422d1-d18e-4652-bd6f-f1b67539bcac?ctid=72f988bf-86f1-41af-91ab-2d7cd011db47"
				target="_blank"><span class="glyphicon glyphicon-share"></span>
				Power BI</a>
		</form>
		<br />
		<table class="table table-striped table-hover">
			<thead>
				<tr>
					<th>#</th>
					<th>PO Number</th>
					<th>POAmountTotal RMB</th>
					<th>InvoiceDateFirst</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="po, status: ${pos}" style="cursor: pointer;">
					<td th:text="${status.count}">1</td>
					<td th:text="${po.poNumber}">Unknown</td>
					<td th:text="${po.amount}">Unknown</td>
					<td
						th:text="${po.invoiceDateFirst != null} ? ${#dates.format(po.invoiceDateFirst, 'M/d/yyyy')}">Unknown</td>
				</tr>
			</tbody>
		</table>
	</div>

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="/jQuery/jquery-3.2.1.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="/Bootstrap/js/bootstrap.min.js"></script>

	<script>
		$(function() {
			$('.js-progress').click(function (){
				$('.masking').css('display', 'block');
				$('body').css('overflow', 'hidden');
				
				var progress = setInterval(function (){
					$.getJSON('/po/progress', function (data){
						if (data == 100) {
							clearInterval(progress);
						}
						$('div.progress-bar').attr('aria-valuemax', data);
						$('div.progress-bar').css('width', data + '%');
						$('div.progress-bar').text(data + '% Complete')
					});
				}, 2000);
			});
		});
	</script>
</body>
</html>
